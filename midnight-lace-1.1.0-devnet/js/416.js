"use strict";(self["webpackChunk_lace_browser_extension_wallet"]=self["webpackChunk_lace_browser_extension_wallet"]||[]).push([[416],{52831:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"6f67e09126f1f0f636629f6d8be36aea.svg"},38987:(e,a,t)=>{var n=t(46062);var r=t.n(n);var c=t(44036);var o=t.n(c);var s=t(96793);var l=t.n(s);var i=t(17892);var v=t.n(i);var d=t(11173);var u=t.n(d);var w=t(42464);var y=t.n(w);var m=t(18710);var g={};g.styleTagTransform=y();g.setAttributes=v();g.insert=l().bind(null,"head");g.domAPI=o();g.insertStyleElement=u();var b=r()(m.Z,g);var S=m.Z&&m.Z.locals?m.Z.locals:void 0},86607:(e,a,t)=>{var n=t(46062);var r=t.n(n);var c=t(44036);var o=t.n(c);var s=t(96793);var l=t.n(s);var i=t(17892);var v=t.n(i);var d=t(11173);var u=t.n(d);var w=t(42464);var y=t.n(w);var m=t(31848);var g={};g.styleTagTransform=y();g.setAttributes=v();g.insert=l().bind(null,"head");g.domAPI=o();g.insertStyleElement=u();var b=r()(m.Z,g);var S=m.Z&&m.Z.locals?m.Z.locals:void 0},90597:(e,a,t)=>{t.a(e,async(e,a)=>{try{var n=t(2784);var r=t(22005);var c=e([r]);r=(c.then?(await c)():c)[0];a()}catch(o){a(o)}})},22005:(e,a,t)=>{t.a(e,async(e,a)=>{try{var n=t(90597);var r=t(86087);var c=e([n,r]);[n,r]=c.then?(await c)():c;a()}catch(o){a(o)}})},87627:(e,a,t)=>{t.a(e,async(e,a)=>{try{var n=t(22005);var r=e([n]);n=(r.then?(await r)():r)[0];a()}catch(c){a(c)}})},89829:(e,a,t)=>{t.a(e,async(e,a)=>{try{var n=t(2784);var r=t(27101);var c=t(41127);var o=t(38987);var s=t(61080);var l=t(38487);var i=e([l]);l=(i.then?(await i)():i)[0];a()}catch(v){a(v)}})},76412:(e,a,t)=>{t.a(e,async(e,a)=>{try{var n=t(2784);var r=t(71275);var c=t(74152);var o=t(45827);var s=t(89829);var l=e([r,c,o,s]);[r,c,o,s]=l.then?(await l)():l;a()}catch(i){a(i)}})},54249:(e,a,t)=>{t.a(e,async(e,a)=>{try{var n=t(89829);var r=t(76412);var c=e([n,r]);[n,r]=c.then?(await c)():c;a()}catch(o){a(o)}})},45871:(e,a,t)=>{t.a(e,async(e,a)=>{try{var n=t(2784);var r=t(14696);var c=t(91248);var o=t(41127);var s=t(62554);var l=t(8119);var i=t(11939);var v=t(72303);var d=t(86607);var u=t(43878);var w=e([r,c,v]);[r,c,v]=w.then?(await w)():w;a()}catch(y){a(y)}})},32021:(e,a,t)=>{t.a(e,async(e,a)=>{try{var n=t(45871);var r=e([n]);n=(r.then?(await r)():r)[0];a()}catch(c){a(c)}})},38783:(e,a,t)=>{t.a(e,async(e,a)=>{try{var n=t(2784);var r=t(97922);var c=t(37153);var o=t(14970);var s=e([r,c,o]);[r,c,o]=s.then?(await s)():s;a()}catch(l){a(l)}})},37153:(e,a,t)=>{t.a(e,async(e,n)=>{try{t.d(a,{gZ:()=>c.gZ});var r=t(38783);var c=t(28005);var o=e([r,c]);[r,c]=o.then?(await o)():o;n()}catch(s){n(s)}})},90653:(e,a,t)=>{t.a(e,async(e,n)=>{try{t.d(a,{l:()=>UnlockWallet});var r=t(2784);var c=t(97922);var o=t(52831);var s=t(41127);var l=t(37992);var i=t(76699);var v=t(54954);var d=e([c]);c=(d.then?(await d)():d)[0];const UnlockWallet=({onUnlock:e,onForgotPasswordClick:a,passwordInput:t,unlockButtonDisabled:n,showForgotPassword:d=true})=>{const{t:u}=(0,i.$)();return r.createElement(c.Dv,null,r.createElement("form",{onSubmit:e,className:l.Z.lockWalletContent},r.createElement("div",{className:l.Z.content,"data-testid":"unlock-screen"},r.createElement("img",{src:o.Z,alt:"LACE",className:l.Z.image,"data-testid":"unlock-screen-img"}),r.createElement("h1",{className:l.Z.title,"data-testid":"unlock-screen-title"},u("unlock.sectionTitle")),r.createElement(s.Password,{errorMessage:u("general.errors.invalidPassword"),error:t.invalidPass,value:t.value,onChange:t.handleChange,onPressEnter:a=>{a.preventDefault();e()},label:u("unlock.input.placeholder")})),r.createElement("div",{className:l.Z.blockButton},r.createElement(s.Button,{color:"gradient",onClick:e,disabled:n,"data-testid":"unlock-button"},u("unlock.button"))),d&&r.createElement(v.o,{onForgotPasswordClick:a})))};n()}catch(u){n(u)}})},96973:(e,a,t)=>{t.a(e,async(e,n)=>{try{t.d(a,{B:()=>useWalletManager});var r=t(2784);var c=t(28879);var o=t.n(c);var s=t(18149);var l=t.n(s);var i=t(83134);var v=t(45827);var d=t(91817);var u=t(80615);var w=t(11939);var y=t(54966);var m=t(62410);var g=t(58718);var b=t(27399);var S=t(24296);var k=t(63791);var h=t(48834)["Buffer"];var C=e([v]);v=(C.then?(await C)():C)[0];const{AVAILABLE_CHAINS:A,CHAIN:E}=(0,g.v)();const connectHardwareWallet=async e=>await i.Wallet.connectDevice(e);const encryptKeyAgents=({keyAgentsByChain:e,password:a})=>i.Wallet.KeyManagement.emip3encrypt(h.from(JSON.stringify(e)),h.from(a));const useWalletManager=()=>{const e=(0,d.$)();const{walletLock:a,setWalletLock:t,keyAgentData:n,setKeyAgentData:c,setCardanoWallet:s,resetWalletLock:g,setCurrentChain:C,setCardanoCoin:f,environmentName:p,walletManagerUi:T,cardanoWallet:x,setAddressesDiscoveryCompleted:I}=(0,v.X$)();const[W,_]=(0,u.jL)();const{utils:{clearTable:M}}=(0,y.y_)([],y.uL);const{utils:{clearTable:D}}=(0,y.y_)([],y.r4);const R=(0,w.M)();const N=(0,S.V)();const B=(0,r.useCallback)(async(e,a)=>{const t=await i.Wallet.KeyManagement.emip3encrypt(h.from(i.Wallet.KeyManagement.util.joinMnemonicWords(e)),h.from(a));await R.setBackgroundStorage({mnemonic:JSON.stringify(t)})},[R]);const F=(0,r.useCallback)(async()=>R.getWalletPassword(),[R]);const Z=(0,r.useCallback)(async(e,a,t=true)=>{try{R.setWalletPassword(h.from(e));return await a()}finally{if(t)R.setWalletPassword()}},[R]);const O=(0,r.useCallback)(async()=>{if(!a)return;await R.clearBackgroundStorage(["keyAgentsByChain"]);(0,m.Rv)("keyAgentData");c();s();I(false)},[a,R,c,s,I]);const K=(0,r.useCallback)(async e=>{if(!a)return;const t=await i.Wallet.KeyManagement.emip3decrypt(a,h.from(e));return JSON.parse(t.toString())},[a]);const P=(0,r.useCallback)(async a=>{var t;if(!n)return;const r=null===(t=(0,b.i)())||void 0===t?void 0:t.name;if(!r||!T)return;const c=await e.restoreWallet(T,r,n,F,p,void 0,a);s(c)},[n,e,T,F,p,s]);const H=(0,r.useCallback)(async({mnemonic:a,name:t,password:n,chainId:r})=>{const{keyAgentsByChain:c,...o}=await Z(n,()=>e.createCardanoWallet(T,t,a,F,r));const s=await encryptKeyAgents({keyAgentsByChain:c,password:n});await B(a,n);await R.setBackgroundStorage({keyAgentsByChain:c});(0,m.jW)({key:"lock",value:s});(0,m.jW)({key:"wallet",value:{name:t}});(0,m.jW)({key:"keyAgentData",value:o.keyAgent.serializableData});return{wallet:o,encryptedKeyAgents:s,name:t}},[R,T,Z,B,F,e]);const L=(0,r.useCallback)(async({walletInstance:e,mnemonicVerificationFrequency:a="",chainName:n=E})=>{_({chainName:n,mnemonicVerificationFrequency:a,lastMnemonicVerification:o()().valueOf().toString()});t(e.encryptedKeyAgents);s(e.wallet);c(e.wallet.keyAgent.serializableData);C(n)},[_,t,s,c,C]);const V=(0,r.useCallback)(async({accountIndex:a=0,deviceConnection:t,name:n,chainId:r,connectedDevice:c})=>e.createHardwareWallet(T,{accountIndex:a,deviceConnection:t,name:n,activeChainId:r,connectedDevice:c}),[T,e]);const X=(0,r.useCallback)(async(e,a=E)=>{const{keyAgentsByChain:n,...r}=e;await R.setBackgroundStorage({keyAgentsByChain:n});(0,m.jW)({key:"wallet",value:{name:r.name}});(0,m.jW)({key:"keyAgentData",value:r.keyAgent.serializableData});_({chainName:a,mnemonicVerificationFrequency:""});t(null);s(r);c(r.keyAgent.serializableData);C(a)},[R,_,t,s,c,C]);const $=(0,r.useCallback)(async(e=false)=>{await i.Wallet.shutdownWallet(T);(0,m.Rv)("appSettings");(0,m.Rv)("showDappBetaModal");(0,m.Rv)("lastStaking");(0,m.Rv)("userInfo");(0,m.Rv)("keyAgentData");await R.clearBackgroundStorage(["message","mnemonic","keyAgentsByChain"]);c();g();s();C(E);if(!e){(0,m.Rv)("wallet");(0,m.Rv)(k.SH);await N.clearId();M();D()}},[T,R,N,M,D,c,g,s,C]);const j=(0,r.useCallback)(async e=>{var a;if(!T)return;const t=i.Wallet.Cardano.ChainIds[e];console.info("Switching chain to",e,A);if(!t||!A.includes(e))throw new Error("Chain not supported");const n=await R.getBackgroundStorage();const r=n.keyAgentsByChain;const o=null===(a=(0,b.i)())||void 0===a?void 0:a.name;if(!r[e]||!o)throw new Error("Wallet data for chosen chain not found");const{keyAgentData:l}=r[e];if(!l)throw new Error("Wallet data for chosen chain is empty");const{asyncKeyAgent:v,keyAgent:d,wallet:u}=await i.Wallet.restoreWalletFromKeyAgent(T,o,l,F,e,false);await i.Wallet.switchKeyAgents(T,o,v,e);I(false);_({...W,chainName:e});(0,m.jW)({key:"wallet",value:{name:o}});(0,m.jW)({key:"keyAgentData",value:l});s({asyncKeyAgent:v,keyAgent:d,name:o,wallet:u});C(e);f(t);c(l)},[R,T,F,I,_,W,s,C,f,c]);const U=(0,r.useCallback)(async({addresses:e,currentChainName:a})=>{const t=i.Wallet.Cardano.ChainIds[a];const n=(0,m.Fz)("keyAgentData");if(!n)return;const r=l()(n.chainId,t);const o=e.every(e=>e.networkId===n.chainId.networkId);const v=r&&o;const d=l()(n.knownAddresses,e);if(!v)return;if(d){I(true);return}let u;if(v){u={...n,knownAddresses:e};(0,m.jW)({key:"keyAgentData",value:u})}const w=await R.getBackgroundStorage();const{name:y}=(0,m.Fz)("wallet");if(!w)throw new Error("Couldn't access background storage");const{keyAgentsByChain:g}=w;null!=u||(u={...g[a].keyAgentData,knownAddresses:e});g[a].keyAgentData=u;await R.setBackgroundStorage({keyAgentsByChain:g});const b=await i.Wallet.createKeyAgent(T,u,F);s({asyncKeyAgent:null==x?void 0:x.asyncKeyAgent,keyAgent:b,name:y,wallet:T.wallet});c(u);I(true)},[R,null==x?void 0:x.asyncKeyAgent,F,I,s,c,T]);return{lockWallet:O,unlockWallet:K,loadWallet:P,createWallet:H,setWallet:L,getPassword:F,createHardwareWallet:V,connectHardwareWallet,saveHardwareWallet:X,deleteWallet:$,executeWithPassword:Z,switchNetwork:j,updateAddresses:U}};n()}catch(f){n(f)}})},80615:(e,a,t)=>{t.d(a,{bW:()=>n.bW,jL:()=>n.jL});var n=t(15888)},91817:(e,a,t)=>{t.d(a,{$:()=>n.$,N:()=>n.N});var n=t(70114)},10936:(e,a,t)=>{t.d(a,{x:()=>n.x,y:()=>n.y});var n=t(37299)},546:(e,a,t)=>{t.a(e,async(e,a)=>{try{var n=t(2784);var r=t(54249);var c=t(97922);var o=t(87627);var s=t(32021);var l=t(77491);var i=t(11905);var v=t(37153);var d=t(38487);var u=t(45827);var w=e([r,c,o,s,i,v,d,u]);[r,c,o,s,i,v,d,u]=w.then?(await w)():w;a()}catch(y){a(y)}})},4851:(e,a,t)=>{t.a(e,async(e,a)=>{try{var n=t(2784);var r=t(546);var c=t(80615);var o=t(45827);var s=t(76461);var l=t(96973);var i=t(28879);var v=t.n(i);var d=t(64989);var u=t.n(d);var w=t(11939);var y=t(62554);var m=t(63655);var g=t(62410);var b=t(69082);var S=t(71275);var k=t(38487);var h=e([r,o,s,l,S,k]);[r,o,s,l,S,k]=h.then?(await h)():h;v().extend(u());a()}catch(C){a(C)}})},43880:(e,a,t)=>{t.d(a,{R:()=>WarningModal});var n=t(2784);var r=t(46755);var c=t(41127);var o=t(46062);var s=t.n(o);var l=t(44036);var i=t.n(l);var v=t(96793);var d=t.n(v);var u=t(17892);var w=t.n(u);var y=t(11173);var m=t.n(y);var g=t(42464);var b=t.n(g);var S=t(92649);var k={};k.styleTagTransform=b();k.setAttributes=w();k.insert=d().bind(null,"head");k.domAPI=i();k.insertStyleElement=m();var h=s()(S.Z,k);const C=S.Z&&S.Z.locals?S.Z.locals:void 0;var A=t(76699);const E=480;const f=264;const WarningModal=({header:e,content:a,visible:t,onCancel:o,onConfirm:s,cancelLabel:l,confirmLabel:i,confirmCustomClassName:v,isPopupView:d,withCancel:u=true})=>{const{t:w}=(0,A.$)();const y=[w("general.warnings.youHaveToStartAgain")];const m=y.includes(String(e));return n.createElement(r.Z,{bodyStyle:{height:d||!m?"100%":f},centered:true,className:C.modal,onCancel:o,footer:null,visible:t,width:d?"100%":E,zIndex:1e4},n.createElement("div",{"data-testid":"delete-address-modal-title",className:C.header},e),n.createElement("div",{"data-testid":"delete-address-modal-description",className:C.content},a),n.createElement("div",{className:C.footer},u&&n.createElement(c.Button,{"data-testid":"delete-address-modal-cancel",block:true,onClick:o,color:"secondary"},null!=l?l:w("general.button.cancel")),n.createElement(c.Button,{className:v,"data-testid":"delete-address-modal-confirm",block:true,onClick:s},null!=i?i:w("general.button.agree"))))}},72303:(e,a,t)=>{t.a(e,async(e,n)=>{try{t.d(a,{F1:()=>HeaderNavigation,Gh:()=>HeaderTitle,vp:()=>x,w4:()=>useHandleClose});var r=t(2784);var c=t(95384);var o=t(62554);var s=t(41127);var l=t(83134);var i=t(43112);var v=t(98655);var d=t(14696);var u=t(54940);var w=t(76699);var y=t(71275);var m=t(74152);var g=t(11939);var b=t(80710);var S=t(43715);var k=t(45827);var h=t(80513);var C=t(59512);var A=t(28732);var E=t(43878);var f=t(65888);var p=e([v,d,y,m,b,k]);[v,d,y,m,b,k]=p.then?(await p)():p;const{SendTransaction:T}=S.iv;const useHandleClose=()=>{const{walletUI:{appMode:e},getKeyAgentType:a}=(0,k.X$)();const t=e===h.fG;const[,n]=(0,v.Lx)();const c=(0,v.xJ)();const o=(0,v.I5)();const{hasOutput:s}=(0,v.WZ)();const[,d]=(0,u.yT)();const{currentSection:w,resetSection:g}=(0,v._7)();const b=(0,y.v)(m.hW.activity);const S=(0,y.v)(m.hW.assets);const C=(0,r.useMemo)(()=>a()===l.Wallet.KeyManagement.KeyAgentType.InMemory,[a]);const A=(0,r.useCallback)(()=>{c();o();g()},[c,o,g]);const E=(0,r.useCallback)(()=>{A();d()},[A,d]);const f=(0,r.useCallback)(()=>{A();S()},[A,S]);const p=(0,r.useCallback)(()=>{if(t){A();b()}else{E();b()}if(!C)window.location.reload()},[E,C,t,b,A]);const T=(0,r.useCallback)(()=>{if(s)n(true);else t?f():E()},[s,n,t,f,E]);const x=(0,r.useCallback)(()=>{if(w.currentSection===i.bx.SUCCESS_TX){t?f():E();if(!C)window.location.reload()}else T()},[w.currentSection,t,f,E,C,T]);return{onClose:x,onCloseSubmitedTransaction:p}};const x=[i.bx.SUMMARY,i.bx.ADDRESS_LIST,i.bx.ADDRESS_FORM,i.bx.CONFIRMATION,i.bx.ASSET_PICKER];const I=new Set([i.bx.ASSET_PICKER,i.bx.ADDRESS_LIST]);const W="output1";const HeaderNavigation=({isPopupView:e})=>{const{t:a}=(0,w.$)();const{onClose:t}=useHandleClose();const{currentSection:n,setPrevSection:l}=(0,v._7)();const{password:u,removePassword:y}=(0,v.iJ)();const m=(0,g.M)();const{setSubmitingTxState:k}=(0,v.JJ)();const h=(0,b.Os)();const[A,f]=(0,v.M$)();const{selectedTokenList:p,resetTokenList:_}=(0,v.Cm)();const{triggerPoint:M}=(0,v.Gc)();const D=(0,r.useCallback)(()=>{if(n.currentSection===i.bx.SUMMARY)h.sendEventToMatomo({action:S.wQ.CLICK_EVENT,category:S.T3.SEND_TRANSACTION,name:e?T.BACK_TX_DETAILS_POPUP:T.BACK_TX_DETAILS_BROWSER})},[n.currentSection,h,e]);const R=e?[...x,i.bx.FORM].includes(n.currentSection):x.includes(n.currentSection);const N=e&&n.currentSection===i.bx.FORM;const B=e&&n.currentSection===i.bx.ASSET_PICKER;const F=!I.has(n.currentSection);const onArrowIconClick=()=>{D();const a=e&&[i.bx.SUCCESS_TX,i.bx.FORM,i.bx.FAIL_TX,i.bx.MIDNIGHT_FORM].includes(n.currentSection);if(u){y();k({isPasswordValid:true})}if(n.currentSection===i.bx.ASSET_PICKER)f(false);if(a)t();else l()};const onCrossIconClick=()=>{if(n.currentSection===i.bx.SUCCESS_TX)h.sendEventToPostHog(S.QE.SendAllDoneXClick,{trigger_point:M});else if(n.currentSection===i.bx.FAIL_TX)h.sendEventToPostHog(S.QE.SendSomethingWentWrongXClick,{trigger_point:M});t()};const{uiOutputs:Z}=(0,d.zJ)(W);const{address:O}=(0,d.Qw)(W);const openTabExtensionSendFlow=()=>{(0,E.Ng)({tempAddress:O,tempOutputs:Z,tempSource:"popup"});m.handleOpenBrowser({section:o.hL.SEND_ADVANCED})};const K=a(p.length>0?"multipleSelection.clear":"multipleSelection.cancel");const P=p.length>0?_:()=>f(!A);return r.createElement(s.DrawerNavigation,{title:e?void 0:r.createElement("div",null,a("core.sendReceive.send")),onArrowIconClick:R?onArrowIconClick:void 0,rightActions:N?r.createElement(s.Button,{className:c.Z.customSizeBtn,color:"secondary",variant:"outlined",onClick:openTabExtensionSendFlow,"data-testid":"add-bundle-button"},a("browserView.transaction.send.drawer.addBundle")):B?r.createElement(C.H,{testId:A?p.length>0?"clear-button":"cancel-button":"select-multiple-button",label:A?K:a("multipleSelection.selectMultiple"),onClick:P,btnStyle:A?{width:"112px",minWidth:"112px"}:{width:"152px",minWidth:"152px"}}):F?r.createElement(s.NavigationButton,{icon:"cross",onClick:onCrossIconClick}):void 0})};const useGetHeaderText=()=>{const{addressToEdit:e}=(0,f.J)();return{[i.bx.FORM]:{title:"browserView.transaction.send.drawer.newTransaction"},[i.bx.SUMMARY]:{title:"browserView.transaction.send.drawer.transactionSummary",subtitle:"browserView.transaction.send.drawer.breakdownOfYourTransactionCost"},[i.bx.CONFIRMATION]:{title:"browserView.transaction.send.confirmationTitle",subtitle:"browserView.transaction.send.signTransactionWithPassword"},[i.bx.SUCCESS_TX]:{title:""},[i.bx.FAIL_TX]:{title:""},[i.bx.ADDRESS_LIST]:{title:"browserView.transaction.send.drawer.addressBook"},[i.bx.ADDRESS_FORM]:{title:"browserView.transaction.send.drawer.addressForm"},[i.bx.ASSET_PICKER]:{title:"core.coinInputSelection.assetSelection"},[i.bx.ADDRESS_CHANGE]:{title:"addressBook.reviewModal.title",name:e.name},[i.bx.MIDNIGHT_FORM]:{title:"browserView.transaction.send.drawer.newTransaction"}}};const HeaderTitle=({popup:e,titleSlot:a})=>{var t;const{t:n}=(0,w.$)();const{currentSection:o}=(0,v._7)();const[l,d]=(0,v.M$)();const{selectedTokenList:u,resetTokenList:y}=(0,v.Cm)();const m=useGetHeaderText();const g=![i.bx.FORM,i.bx.FAIL_TX,i.bx.MIDNIGHT_FORM].includes(o.currentSection);const b=g?n(m[o.currentSection].title,{name:m[o.currentSection].name}):void 0;const S=(null===(t=m[o.currentSection])||void 0===t?void 0:t.subtitle)?n(m[o.currentSection].subtitle):void 0;const k=n(u.length>0?"multipleSelection.clear":"multipleSelection.cancel");const h=u.length>0?y:()=>d(!l);const E=e?u.length>0?r.createElement(A.l,{count:u.length}):null:r.createElement(C.H,{testId:l?u.length>0?"clear-button":"cancel-button":"select-multiple-button",count:u.length>0?u.length:void 0,label:l?k:n("multipleSelection.selectMultiple"),onClick:h,btnStyle:l?{width:"112px"}:{width:"152px"}});return g&&r.createElement(s.DrawerHeader,{popupView:e,title:r.createElement("div",{className:c.Z.header},r.createElement("div",{className:c.Z.title},b),a,o.currentSection===i.bx.ASSET_PICKER&&E),subtitle:S})};n()}catch(_){n(_)}})},91248:(e,a,t)=>{t.a(e,async(e,n)=>{try{t.d(a,{$_:()=>c.$,F1:()=>r.F1,vp:()=>r.vp,w4:()=>r.w4});var r=t(70129);var c=t(52886);var o=e([r,c]);[r,c]=o.then?(await o)():o;n()}catch(s){n(s)}})}}]);